<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> -->
    <title>Osmovo</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { // A more modern blue/indigo palette
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1', // Main primary color
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        },
                        secondary: { // A complementary accent
                            50: '#fdf2f8',
                            100: '#fce7f3',
                            200: '#fbcfe8',
                            300: '#f9a8d4',
                            400: '#f472b6',
                            500: '#ec4899',
                            600: '#db2777',
                            700: '#be185d',
                            800: '#9d174d',
                            900: '#831843',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'], // Modern sans-serif font
                    },
                }
            }
        }
    </script>
    <!-- MathJax -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"></script>
    <!-- Marked.js - Add for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Initialize KaTeX auto-render
            if (typeof renderMathInElement === 'function') {
                renderMathInElement(document.body, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\(', right: '\\)', display: false},
                        {left: '\\[', right: '\\]', display: true}
                    ],
                    throwOnError: false
                });
            }
        });
    </script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        
        header {
            padding-top: 0.5rem !important; /* Reduce top padding */
            padding-bottom: 0.5rem !important; /* Reduce bottom padding */
        }
        
        .container.mx-auto {
            padding-top: 0.5rem !important; /* Reduce top padding */
            padding-bottom: 0.5rem !important; /* Reduce bottom padding */
        }
        
        #chat-container {
            margin-bottom: 0.5rem !important; /* Reduce bottom margin */
        }
    </style>
</head>
<body class="bg-primary-50 h-screen flex flex-col font-sans">
    <header class="bg-white text-primary-700 p-4 shadow-sm border-b border-primary-200">
        <div class="container mx-auto flex flex-wrap justify-between items-center">
            <!-- Left side - Conversations toggle + App Title -->
            <div class="flex items-center my-auto">
                <button id="toggle-conversations" class="p-2 rounded-lg text-primary-500 hover:bg-primary-100 mr-3 hidden md:block my-auto">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                
                <h1 class="text-2xl md:text-3xl font-bold text-primary-600 mr-4 my-auto">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 inline-block mr-2 -mt-1" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z" />
                        <path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h1a2 2 0 002-2V9a2 2 0 00-2-2h-1z" />
                    </svg>
                    Osmovo
                </h1>
            </div>
            
            <!-- Middle - Model Selection - Redesigned -->
           
            
            <!-- Add Clear Chat button -->
            <button id="clear-chat" class="hidden md:flex items-center p-2.5 rounded-lg bg-red-50 text-red-500 hover:bg-red-100 mr-3 transition-all duration-300 gap-1.5 my-auto">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                </svg>
                <span class="font-medium">Temizle</span>
            </button>
            
            <!-- Right side buttons - Mobile view (Reversed order for right alignment) -->
            <div class="flex items-center my-auto">
                <!-- Add toggle-documents button -->
                <button id="toggle-documents" class="p-2 rounded-lg text-primary-500 hover:bg-primary-100 mr-3 hidden md:block my-auto">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </button>

                <!-- Mobile conversations toggle -->
                <button id="toggle-conversations-mobile" class="md:hidden p-2 rounded-lg text-primary-500 hover:bg-primary-100 mr-2 my-auto">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                </button>
                
                <!-- Existing sidebar toggle button -->
                <button id="toggle-sidebar" class="md:hidden p-2 rounded-lg text-primary-500 hover:bg-primary-100 mr-2 my-auto">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                    </svg>
                </button>
                
                <!-- Clear Chat button for mobile -->
                <button id="clear-chat-mobile" class="md:hidden p-2.5 rounded-lg bg-red-50 text-red-500 hover:bg-red-100 transition-all duration-300 my-auto">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden container mx-auto py-2 md:py-3 space-x-0 md:space-x-2">
        <!-- Conversations Sidebar -->
        <div id="conversation-sidebar" class="w-full md:w-80 bg-white shadow-xl rounded-xl overflow-hidden md:block fixed md:static top-0 left-0 bottom-0 md:h-auto z-30 transform translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col">
            <!-- Conversations Header -->
            <div class="bg-gradient-to-r from-primary-600 to-primary-700 p-4 md:p-5 shadow-sm flex-shrink-0">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold text-white flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-3.582 8-8 8a8.955 8.955 0 01-3.774-.829L3 21l1.829-6.226A8.955 8.955 0 013 12a8 8 0 018-8c4.418 0 8 3.582 8 8z" />
                        </svg>
                        Sohbetler
                    </h2>
                    <div class="flex items-center">
                        <button id="new-conversation" class="text-white hover:text-primary-200 mr-2 p-1 rounded" title="Yeni sohbet">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                            </svg>
                        </button>
                        <button id="close-conversations" class="md:hidden text-white hover:text-primary-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
                <p class="text-primary-100 text-sm mt-1">Geçmiş sohbetlerinizi görüntüleyin</p>
            </div>
            
            <!-- Conversations List - Updated for scrolling -->
            <div class="flex-1 min-h-0 overflow-hidden">
                <div id="conversations-list" class="h-full p-4 space-y-2">
                    <!-- Conversations will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="flex-1 flex flex-col p-0 md:p-0">
            <div id="chat-container" class="flex-1 bg-white rounded-xl shadow-lg p-3 mb-2 overflow-y-auto max-h-[calc(100vh-200px)]">
                <!-- Chat messages will be dynamically added here -->
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-2 md:p-3">
                <form id="chat-form" class="flex items-center space-x-2">
                    <input 
                        type="text" 
                        id="message-input" 
                        placeholder="PDF'leriniz hakkında bir şey sorun..." 
                        class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-shadow duration-200"
                    >
                    <button 
                        type="submit" 
                        class="bg-primary-600 text-white p-3 rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200 transform hover:scale-105 flex items-center justify-center"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </form>
            </div>
        </div>

        <!-- Sidebar for PDF Upload - Existing -->
        <div id="sidebar" class="w-full md:w-80 bg-white shadow-xl rounded-xl overflow-hidden md:block fixed md:static top-0 right-0 bottom-0 md:h-auto z-30 transform translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out flex flex-col">
            <!-- PDF Sidebar Header -->
            <div class="bg-gradient-to-r from-primary-600 to-primary-700 p-4 md:p-5 shadow-sm flex-shrink-0">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold text-white flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                        </svg>
                        Belgelerim
                    </h2>
                    <div class="flex items-center">
                        <button id="close-sidebar" class="md:hidden text-white hover:text-primary-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>
                <p class="text-primary-100 text-sm mt-1">Belgelerinizi yönetin</p>
            </div>
            
            <div class="p-4 md:p-5 flex flex-col h-full overflow-hidden">
                <form id="upload-form" class="flex flex-col mb-4 md:mb-6 shrink-0">
                    <label for="pdf-upload-btn" class="mb-2 font-medium text-primary-700 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1 text-primary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        Yeni PDF Yükle
                    </label>
                    <div class="flex">
                        <input 
                            type="file" 
                            id="pdf-upload" 
                            accept=".pdf" 
                            class="hidden"
                        >
                        <button 
                            type="button" 
                            id="pdf-upload-btn"
                            class="flex-1 text-left p-2.5 border border-gray-300 rounded-l-lg text-gray-500 bg-gray-50 hover:bg-gray-100 truncate transition-colors duration-200"
                        >
                            PDF Seçin...
                        </button>
                        <button 
                            type="submit" 
                            class="bg-primary-600 text-white px-4 py-2.5 rounded-r-lg hover:bg-primary-700 transition-all duration-200 transform hover:scale-105"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                <polyline points="17 8 12 3 7 8"/>
                                <line x1="12" y1="3" x2="12" y2="15"/>
                            </svg>
                        </button>
                    </div>
                    <div id="file-name-display" class="mt-2 text-sm text-gray-600 truncate"></div>
                </form>
                
                <div class="flex flex-col h-full min-h-0 mb-2">
                    <div class="flex justify-between items-center mb-3 pb-2 border-b border-gray-200 shrink-0">
                        <h3 class="font-medium text-primary-700 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Yüklenen PDF'ler
                        </h3>
                        <span id="pdf-count" class="bg-primary-100 text-primary-700 text-xs font-semibold px-2.5 py-1 rounded-full">0</span>
                    </div>
                    
                    <!-- Add PDF actions toolbar -->
                    <div class="flex justify-between items-center mb-2 text-sm">
                        <button id="select-all-pdfs" class="flex items-center text-primary-600 hover:text-primary-800 px-2 py-1 rounded hover:bg-primary-50 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 11l3 3L22 4"/>
                                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                            </svg>
                            Tümünü Seçin
                        </button>
                        
                        <button id="delete-all-pdfs" class="flex items-center text-red-500 hover:text-red-700 px-2 py-1 rounded hover:bg-red-50 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="3 6 5 6 21 6"/>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                <line x1="10" y1="11" x2="10" y2="17"/>
                                <line x1="14" y1="11" x2="14" y2="17"/>
                            </svg>
                            Tümünü Sil
                        </button>
                    </div>
                    
                    <div class="pdf-list-container relative flex-grow h-full">
                        <ul id="pdf-list" class="space-y-2 overflow-y-auto pr-1 custom-scrollbar h-full">
                            <!-- PDF files will be listed here -->
                            <li class="text-gray-500 text-sm italic p-2 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Henüz PDF yüklenmemiş.
                            </li>
                        </ul>
                        <!-- Scroll indicator arrow -->
                        <div id="scroll-indicator" class="hidden absolute bottom-0 right-0 left-0 w-full h-10 pointer-events-none">
                            <div class="flex justify-center items-center w-full h-full bg-gradient-to-t from-white via-white/95 to-transparent">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary-500 animate-bounce" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add event listener for mobile conversations toggle -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const toggleConversationsMobile = document.getElementById('toggle-conversations-mobile');
            const conversationSidebar = document.getElementById('conversation-sidebar');
            
            if (toggleConversationsMobile) {
                toggleConversationsMobile.addEventListener('click', () => {
                    conversationSidebar.classList.toggle('translate-x-full');
                    
                    // Toggle active class for arrow rotation
                    toggleConversationsMobile.classList.toggle('active');
                });
            }

                   checkAuthAndRedirect(); 
        });
    </script>
    
    <script src="system.js"></script>
        <script src="main.js"></script>

</body>
</html>
